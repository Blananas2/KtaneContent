<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Morse-A-Maze — Keep Talking and Nobody Explodes Module</title>
    <meta name="viewport" content="initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type='text/css' href="css/font.css">
    <script src='js/highlighter.js'></script>
    <script src="js/ruleseed.js"></script>
    <style>
        ul {
            margin: 0;
            padding: 0;
            margin-left: 24px;
        }

        #morse-maze-chart {
            margin-right: 1em;
            height: 29em;
            width: 22.8270625em; /* Hardcode for IE */
            border: 1px solid #021a40;
            background-color: #ffffff;
        }

        .morse-maze {
            width: 13em;
            height: 13em;
        }
    </style>
    <script>
        function removeWalls(m1, m2)
        {
            if (m1.x - m2.x == 1)
            {
                m1.wallLeft = false;
                m2.wallRight = false;
            }
            if (m1.x - m2.x == -1)
            {
                m1.wallRight = false;
                m2.wallLeft = false;
            }
            if (m1.y - m2.y == 1)
            {
                m1.wallUp = false;
                m2.wallDown = false;
            }
            if (m1.y - m2.y == -1)
            {
                m1.wallDown = false;
                m2.wallUp = false;
            }
        }

        class Maze
        {
            constructor()
            {
                this.CellGrid = new Array(6);
                for (var i = 0; i < 6; i++)
                {
                    this.CellGrid[i] = new Array(6);
                    for (var j = 0; j < 6; j++)
                        this.CellGrid[i][j] = { x: i, y: j, visited: false, wallUp: true, wallDown: true, wallLeft: true, wallRight: true };
                }
            }

            BuildMaze(rnd)
            {
                for (var i = 0; i < 6; i++)
                {
                    for (var j = 0; j < 6; j++)
                    {
                        if (i > 0) rnd.next();
                        if (j > 0) rnd.next();
                    }
                }
                this.PopulateMaze(rnd);
                rnd.next();
                rnd.next();   // Burn the coordinate circles.
            }

            PopulateMaze(rnd)
            {
                var x = rnd.next(0, 6);
                var y = rnd.next(0, 6);
                this.VisitCell(this.CellGrid[x][y], [], rnd);
            }

            VisitCell(cell, cellStack, rnd)
            {
                while (cell != null)
                {
                    cell.visited = true;
                    var mazeCell = this.GetNextNeigbour(cell, rnd);
                    if (mazeCell != null)
                    {
                        removeWalls(cell, mazeCell);
                        cellStack.push(cell);
                    }
                    else if (cellStack.length > 0)
                        mazeCell = cellStack.pop();
                    cell = mazeCell;
                }
            }

            GetNextNeigbour(cell, rnd)
            {
                var list = [];
                if (cell.x > 0 && !this.CellGrid[cell.x - 1][cell.y].visited) list.push(this.CellGrid[cell.x - 1][cell.y]);
                if (cell.x < 5 && !this.CellGrid[cell.x + 1][cell.y].visited) list.push(this.CellGrid[cell.x + 1][cell.y]);
                if (cell.y > 0 && !this.CellGrid[cell.x][cell.y - 1].visited) list.push(this.CellGrid[cell.x][cell.y - 1]);
                if (cell.y < 5 && !this.CellGrid[cell.x][cell.y + 1].visited) list.push(this.CellGrid[cell.x][cell.y + 1]);
                return list.length > 0 ? list[rnd.next(0, list.length)] : null;
            }

            ToSVG()
            {
                var svg = '';
                for (var i = 0; i < 6; i++)
                {
                    for (var j = 0; j < 6; j++)
                    {
                        var mazeCell = this.CellGrid[i][j];
                        var x = i * 50;
                        var y = j * 50;
                        svg += `<circle cx='${x + 25}' cy='${y + 25}' r='3' fill='black' />`;
                        if (mazeCell.wallUp)
                            svg += `<line x1='${x}' y1='${y}' x2='${x + 50}' y2='${y}' stroke-width='${j === 0 ? 10 : 3}' stroke='black' fill='none' />`;
                        if (mazeCell.wallLeft)
                            svg += `<line x1='${x}' y1='${y}' x2='${x}' y2='${y + 50}' stroke-width='${i === 0 ? 10 : 3}' stroke='black' fill='none' />`;
                        if (i == 5)
                            svg += `<line x1='${x + 50}' y1='${y}' x2='${x + 50}' y2='${y + 50}' stroke-width='10' stroke='black' fill='none' />`;
                        if (j == 5)
                            svg += `<line x1='${x}' y1='${y + 50}' x2='${x + 50}' y2='${y + 50}' stroke-width='10' stroke='black' fill='none' />`;
                    }
                }
                return `<svg viewBox='0 0 300 300'>${svg}</svg>`;
            }
        }

        function setRules(rnd)
        {
            var Mazes = [];
            switch (rnd.seed)
            {
                case 1:
                    for (var i = 0; i < 9; i++)
                    {
                        var maze = new Maze();
                        maze.BuildMaze(rnd);
                        Mazes.push(maze);
                    }
                    var rnd2 = new MonoRandom(2);
                    var list = [];
                    for (var i = 0; i < 9; i++)
                    {
                        var maze = new Maze();
                        maze.BuildMaze(rnd2);
                        list.push(maze);
                    }
                    Mazes.push(list[2]);
                    Mazes.push(list[3]);
                    Mazes.push(list[8]);
                    Mazes.push(list[6]);
                    Mazes.push(list[1]);
                    Mazes.push(list[0]);
                    Mazes.push(list[4]);
                    Mazes.push(list[5]);
                    Mazes.push(list[7]);
                    break;
                case 2:
                    for (var i = 0; i < 9; i++)
                    {
                        new Maze().BuildMaze(rnd); //Burn the first 9 mazes out of seed 2. Seed 1 ruleset already used them.
                    }
                    for (var i = 0; i < 18; i++)
                    {
                        var maze = new Maze();
                        maze.BuildMaze(rnd);
                        Mazes.push(maze);
                    }
                    break;
                default:
                    for (var i = 0; i < 18; i++)
                    {
                        var maze = new Maze();
                        maze.BuildMaze(rnd);
                        Mazes.push(maze);
                    }
                    break;
            }

            for (var i = 0; i < 18; i++)
                document.getElementById('morse-maze-' + i).innerHTML = Mazes[i].ToSVG();
        }

        function setDefaultRules(rnd)
        {
            setRules(rnd);
        }
    </script>
</head>
<body>
    <div class="section">
        <div class="page page-bg-02">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Morse-A-Maze</span>
            </div>
            <div class="page-content">
                <img src="img/Component/Morse-A-Maze.svg" class="diagram" />
                <h2>On the Subject of Morse-A-Maze</h2>
                <p class="flavour-text">It is AMazing that the status light got a life of its own.</p>
                <ul>
                    <li>Decode the Morse code from the blinking status light. Off state is green, On state is red.**</li>
                    <li>The first thing transmitted is the word used to find the maze.</li>
                    <li>The second thing transmitted is the coordinates the status light needs to be placed on. Coordinates are a letter from A–F, representing columns, followed by a number from 1–6, representing rows. The upper left is A1.</li>
                    <li>If the word is listed in Table 1, use the corresponding information in the table to determine which maze to look up. If the number you get is greater than 18, keep subtracting 18 until you are in the range of 0–17.</li>
                    <li>Otherwise, look up the word in Tables 2 and 3.</li>
                    <li><strong>Warning:</strong> Do not cross the lines shown in the maze. These lines are invisible on the bomb.</li>
                    <li>If there is an unlit BOB indicator and 4 batteries in 3 holders in the configuration of 2×AA and 2×D, Bob will actively prevent you from earning any strikes. Thanks Bob.</li>
                </ul>
                Table 1:
                <table>
                    <tr>
                        <td>SHELL*</td>
                        <td colspan="3">
                            <ul>
                                <li>If any two-factor widgets are present, use the sum of the 2nd least significant digit of each two-factor code.</li>
                                <li>Otherwise, use the number of unsolved modules.</li>
                            </ul>
                        </td>
                    </tr>
                    <tr><td>LEAKS*</td><td>Number of solved modules</td><td>STRIKE*</td><td>Number of strikes</td></tr>
                    <tr><td>HELLO</td><td>Number of battery holders</td><td>VICTOR</td><td>Number of unique ports</td></tr>
                    <tr><td>ALIEN 3</td><td>Total number of ports</td><td>BISTRO</td><td>Number of lit indicators</td></tr>
                    <tr><td>TANGO</td><td>Number of unlit indicators</td><td>TIMER</td><td>Number of indicators</td></tr>
                    <tr><td>BOXES</td><td>Number of port plates</td><td>TRICK</td><td>The last digit of the serial number</td></tr>
                    <tr><td>PENGUIN</td><td>The sum of the serial number digits</td><td>STING</td><td>Number of batteries</td></tr>
                    <tr><td>ELIAS</td><td>First serial number digit</td><td>KTANE</td><td>Starting time in minutes</td></tr>
                    <tr><td>MANUAL</td><td>Day of week at bomb start<br>(Sunday = 0, Saturday = 6).</td><td>ZULU</td><td>Number of empty port plates</td></tr>
                    <tr><td>NOVEMBER</td><td colspan="3">Position of first serial number letter minus one (A=0, B=1, C=2, ...)</td></tr>
                </table>
                * - The maze for these words can change.<br>
                ** - Refer to page 3 for colorblind mode details. Refer to page 4 for some configuration options.
            </div>
            <div class="page-footer relative-footer">Page 1 of 4</div>
        </div>
        <div class="page page-bg-02">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Morse-A-Maze</span>
            </div>
            <div class="page-content">
                Table 2:
                <table style="border: none">
                    <tr>
                        <td>0 - KABOOM<div class="morse-maze" id="morse-maze-0"></div></td>
                        <td>1 - UNICORN<div class="morse-maze" id="morse-maze-1"></div></td>
                        <td>2 - QUEBEC<div class="morse-maze" id="morse-maze-2"></div></td>
                    </tr>
                    <tr>
                        <td>3 - BASHLY<div class="morse-maze" id="morse-maze-3"></div></td>
                        <td>4 - SLICK<div class="morse-maze" id="morse-maze-4"></div></td>
                        <td>5 - VECTOR<div class="morse-maze" id="morse-maze-5"></div></td>
                    </tr>
                    <tr>
                        <td>6 - FLICK<div class="morse-maze" id="morse-maze-6"></div></td>
                        <td>7 - TIMWI<div class="morse-maze" id="morse-maze-7"></div></td>
                        <td>8 - STROBE<div class="morse-maze" id="morse-maze-8"></div></td>
                    </tr>
                </table>
            </div>
            <div class="page-footer relative-footer">Page 2 of 4</div>
        </div>
        <div class="page page-bg-03">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Morse-A-Maze</span>
            </div>
            <div class="page-content">
                Table 3:
                <table style="border: none">
                    <tr>
                        <td>9 - BOMBS<div class="morse-maze" id="morse-maze-9"></div></td>
                        <td>10 - BRAVO<div class="morse-maze" id="morse-maze-10"></div></td>
                        <td>11 - LAUNDRY<div class="morse-maze" id="morse-maze-11"></div></td>
                    </tr>
                    <tr>
                        <td>12 - BRICK<div class="morse-maze" id="morse-maze-12"></div></td>
                        <td>13 - KITTY<div class="morse-maze" id="morse-maze-13"></div></td>
                        <td>14 - HALLS<div class="morse-maze" id="morse-maze-14"></div></td>
                    </tr>
                    <tr>
                        <td>15 - STEAK<div class="morse-maze" id="morse-maze-15"></div></td>
                        <td>16 - BREAK<div class="morse-maze" id="morse-maze-16"></div></td>
                        <td>17 - BEATS<div class="morse-maze" id="morse-maze-17"></div></td>
                    </tr>
                </table>
                <p>
                    *If Colorblind mode is enabled, the module will ensure that at least the <strong>OffState</strong> or the <strong>MorseXmitState</strong>
                    is set to Off, regardless of current configuration options.
                </p>
            </div>
            <div class="page-footer relative-footer">Page 3 of 4</div>
        </div>
        <div class="page page-bg-04">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Morse-A-Maze</span>
            </div>
            <div class="page-content">
                <img id="morse-maze-chart" src="img/Morse-A-Maze/International_Morse_Code.svg">
                <p>
                    <em>Configuration Options for <strong>MorseAMaze-settings.txt</strong></em><br>
                    It is possible to change the colors of the status light for the various states of the module.
                    The following colors are possible.
                </p>
                <ul>
                    <li>0 - Off</li>
                    <li>1 - Green</li>
                    <li>2 - Red</li>
                    <li>3 - Random</li>
                </ul>
                <p>These are the options that can be configured, and their default values.</p>
                <ul>
                    <li>
                        <strong>SolvedState</strong> - The state the status light changes to once the module is solved.
                        (default: <b>Off</b>)
                    </li>
                    <li>
                        <strong>StrikeState</strong> - The state the status light changes to for one second when a strike is earned.
                        (default: <b>Off</b>)
                    </li>
                    <li>
                        <strong>OffState</strong> - The off state of the status light while morse code is being transmitted.
                        (default: <b>Green</b>)
                    </li>
                    <li>
                        <strong>MorseXmitState</strong> - The on state of the status light while morse code is being transmitted.
                        (default: <b>Red</b>)
                    </li>
                </ul>
                <p>
                    Finally, if you wish to reset everything back to default, just change "<b>ResetToDefault</b>"
                    from <b><em>false</em></b> to <b><em>true</em></b>
                </p>
            </div>
            <div class="page-footer relative-footer">Page 4 of 4</div>
        </div>
    </div>
</body>
</html>
