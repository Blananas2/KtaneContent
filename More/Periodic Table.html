<html>
<head>
    <style>
        body {
            background: #ddd;
            font-family: 'Georgia';
        }
        .module {
            border: 2px solid #666;
            width: 80px;
            height: 58px;
            float: left;
            text-align: center;
            position: relative;
            margin-right: -2px;
            margin-bottom: -2px;
        }
        .symbol {
            position: absolute;
            box-sizing: border-box;
            left: 0;
            right: 0;
            top: 0;
            height: 36px;
            padding: 7px 3px 0 36px;
            font-size: 18pt;
            text-align: center;
            background-size: 32px 32px;
            background-position: 2px 2px;
            background-repeat: no-repeat;
        }
        .souvenir {
            position: absolute;
            left: 35px;
            top: -1px;
            font-size: 8pt;
            text-align: left;
            font-family: 'Cambria';
        }
        .tpscore {
            position: absolute;
            right: 2px;
            top: -1px;
            font-size: 8pt;
            text-align: right;
            font-family: 'Cambria';
        }
        .name {
            position: absolute;
            left: 0;
            right: 0;
            top: 35px;
            bottom: 2px;
            font-size: 6pt;
        }
            .name .inner {
                position: absolute;
                left: 50%;
                top: 50%;
                width: 100%;
                transform: translate(-50%, -50%);
            }
    </style>
</head>
<body>
<div id='bomb'>
</div>
<script>
    var xhr = new XMLHttpRequest();
    xhr.open('GET', '../json/raw');
    xhr.send(null);

    xhr.onreadystatechange = function () {
        if (xhr.readyState !== 4)
            return;
        if (xhr.status !== 200) {
            console.log(xhr);
            return;
        }
        var data = JSON.parse(xhr.responseText).KtaneModules.filter(m => m.Type === 'Regular' || m.Type === 'Needy');
        var symbolsRaw = "Anagrams=A;Adjacent Letters=Ad;Algebra=Ae;Adventure Game=Ag;Alphabet=Al;Morse-A-Maze=Am;Alphabet Numbers=An;Answering Questions=Aq;Astrology=As;The Button=B;Blind Alley=Ba;Broken Buttons=Bb;Big Circle=Bc;Burglar Alarm=Bg;Black Hole=Bh;Bitmaps=Bi;Backgrounds=Bk;Binary LEDs=Bl;Button Masher=Bm;Square Button=Bn;Bitwise Operations=Bo;Battleship=Bp;Button Sequences=Bq;Braille=Br;British Slang=Bs;Binary Tree=Bt;The Bulb=Bu;Boolean Venn Diagram=Bv;Blind Maze=Bz;The Code=C;Calendar=Ca;Complicated Buttons=Cb;Connection Check=Cc;Symbolic Coordinates=Cd;Symbol Cycle=Ce;Color Flash=Cf;Chess=Ch;Coordinates=Ci;The Clock=Ck;Curriculum=Cl;Color Math=Cm;Cooking=Cn;Complex Keypad=Co;Caesar Cipher=Cp;Colored Squares=Cq;Creation=Cr;Character Shift=Cs;Cheap Checkout=Ct;The Cube=Cu;Colored Switches=Cw;Color Morse=Cx;Cryptography=Cy;Crazy Talk=Cz;Determinants=D;Double Color=Dc;Dragon Energy=De;Color Decoding=Dg;Digital Root=Di;Double-Oh=Do;Dr. Doctor=Dr;Error Codes=Ec;Emoji Math=Ej;Edgework=Ek;English Test=En;Equations=Eq;S.E.T.=Et;European Travel=Ev;Extended Password=Ex;Faulty Backgrounds=Fb;Forget Everything=Fe;Flags=Fg;Filibuster=Fi;Flashing Lights=Fl;Fast Math=Fm;Forget Me Not=Fn;Foreign Exchange Rates=Fo;Friendship=Fr;Font Select=Fs;Follow the Leader=Ft;Festive Piano Keys=Fv;FizzBuzz=Fz;The Gamepad=G;Logic Gates=Ga;Game of Life Cruel=Gc;Color Generator=Ge;Greek Calculus=Gk;Game of Life=Gl;Grid Matching=Gm;Graffiti Numbers=Gn;Gridlock=Gr;Guitar Chords=Gu;Hexamaze=H;Hex To Decimal=Hd;Sonic the Hedgehog=He;Human Resources=Hr;HTTP Response=Ht;Hunting=Hu;Identity Parade=I;Ice Cream=Ic;The iPhone=Ip;The Jukebox=J;The Jewel Vault=Jv;Knob=K;Mortal Kombat=Ko;Keypad=Kp;Know Your Way=Kw;Logic=L;Lasers=La;Logical Buttons=Lb;Combination Lock=Lc;Laundry=Ld;LEGO=Le;LED Grid=Lg;Light Cycle=Lh;Listening=Li;Letter Keys=Lk;Lights Out=Lo;Lightspeed=Ls;Splitting The Loot=Lt;The London Underground=Lu;LED Encryption=Ly;Memory=M;Mastermind=Ma;Maze Scrambler=Mb;Morse Code=Mc;Modern Cipher=Md;Maintenance=Me;Mafia=Mf;Maritime Flags=Mg;Mashematics=Mh;Microcontroller=Mi;Mineseeker=Mk;Mastermind Cruel=Ml;Mouse In The Maze=Mm;Monsplode Trading Cards=Mn;The Moon=Mo;Monsplode, Fight!=Mp;Mystic Square=Mq;Shape Memory=Mr;Motion Sense=Ms;The Stock Market=Mt;Murder=Mu;Minesweeper=Mw;Morsematics=Mx;Modules Against Humanity=My;Maze=Mz;Neutralization=N;The Number Cipher=Nb;Capacitor Discharge=Nc;Math=Nm;Nonogram=No;Number Pad=Np;The Number=Nu;Orientation Cube=O;Only Connect=Oc;Password=P;Painting=Pa;Cruel Piano Keys=Pc;Point of Order=Pd;Playfair Cipher=Pf;Pie=Pi;Piano Keys=Pk;Plumbing=Pl;Polyhedral Maze=Pm;Pattern Cube=Pn;Poker=Po;Perspective Pegs=Pp;Probing=Pr;Symbolic Password=Ps;Perplexing Wires=Pw;Press X=Px;Poetry=Py;QR Code=Qr;Chord Qualities=Qu;Round Keypad=R;Radiator=Ra;Rapid Buttons=Rb;Resistors=Re;Rhythms=Rh;Random Number Generator=Rn;Rock-Paper-Scissors-Lizard-Spock=Ro;Rotary Phone=Rp;Rubik’s Cube=Rs;Refill that Beer!=Rt;Rubik’s Clock=Ru;The Swan=S;Sea Shells=Sa;Subways=Sb;Simon Screams=Sc;Skewed Slots=Sd;Semaphore=Se;Safety Safe=Sf;Simon Sings=Sg;Simon Shrieks=Sh;The Switch=Si;Skyrim=Sk;Silly Slots=Sl;Simon Samples=Sm;Sink=Sn;Simon Says=So;Shape Shift=Sp;The Screw=Sr;Simon States=Ss;Simon’s Star=St;The Sun=Su;Souvenir=Sv;Switches=Sw;Simon Sends=Sx;Synonyms=Sy;Synchronization=Sz;Two Bits=T;Tangrams=Ta;Third Base=Tb;Tap Code=Tc;Tetris=Te;Text Field=Tf;Tic-Tac-Toe=Ti;The Time Keeper=Tk;3D Maze=Tm;Turtle Robot=Tr;Turn The Keys=Ts;3D Tunnels=Tt;Marble Tumble=Tu;Tax Returns=Tx;Turn The Key=Ty;Timezones=Tz;Superlogic=Ul;Uncolored Squares=Uq;USA Maze=Us;Venting Gas=V;Visual Impairment=Vi;Complicated Wires=Vw;Wires=W;Waste Management=Wa;Web Design=Wd;Who’s on First=Wh;The Wire=Wi;Who’s That Monsplode=Wm;Word Search=Wo;Wire Placement=Wp;Wire Sequence=Wq;Word Scramble=Ws;The Stopwatch=Wt;Morse War=Wx;X01=X;X-Ray=Xr;Yahtzee=Y;Zoo=Z".split(';').map(str => str.split('='));

        var symbols = {};
        for (var i = 0; i < symbolsRaw.length; i++)
            symbols [ symbolsRaw[i][0] ] = symbolsRaw[i][1];
        for (var i = 0; i < data.length; i++)
            data[i].Symbol = symbols[data[i].Name];

        data.sort(function(a, b) {
            return a.Published < b.Published ? -1 : a.Published > b.Published ? 1 : 0;
        });

        var difficulties = {
            VeryEasy: '#dfd',
            Easy    : '#efd',
            Medium  : '#ffd',
            Hard    : '#fed',
            VeryHard: '#fdd'
        };
        var souvenirStatuses = {
            NotACandidate: 'N',
            Considered   : 'C',
            Planned      : 'P',
            Supported    : 'S'
        };
        var bomb = document.getElementById('bomb');
        for (var i = 0; i < data.length; i++)
        {
            var name = data[i].Name;

            var div = document.createElement('div');
            div.className = 'module';
            div.style.backgroundColor = difficulties[data[i].ExpertDifficulty];

            var symbolDiv = document.createElement('div');
            symbolDiv.className = 'symbol';
            symbolDiv.innerText = data[i].Symbol || '??';
            symbolDiv.style.backgroundImage = `url('../Icons/${data[i].Name}.png')`;
            symbolDiv.style.backgroundColor = difficulties[data[i].DefuserDifficulty];

            var souvenirDiv = document.createElement('div');
            souvenirDiv.className = 'souvenir';
            souvenirDiv.innerText = souvenirStatuses [ (data[i].Souvenir && data[i].Souvenir.Status) || 'NotACandidate' ];
            var tpscoreDiv = document.createElement('div');
            tpscoreDiv.className = 'tpscore';
            tpscoreDiv.innerText = data[i].TwitchPlaysScore || '';

            var nameDiv = document.createElement('div');
            nameDiv.className = 'name';

            var nameInnerDiv = document.createElement('div');
            nameInnerDiv.className = 'inner';
            nameInnerDiv.innerText = data[i].DisplayName || data[i].Name;

            nameDiv.appendChild(nameInnerDiv);
            div.appendChild(symbolDiv);
            div.appendChild(nameDiv);
            div.appendChild(tpscoreDiv);
            div.appendChild(souvenirDiv);
            bomb.appendChild(div);
        }

        /*
        var keys = data.filter(d => d.Symbol).map(d => d.Symbol);
        keys.sort();

        var alphabet = "a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z".split(',');
        for (var i = 0; i < 26; i++) {
            var div = document.createElement('div');
            div.style.clear = 'both';
            var letter = String.fromCharCode(65 + i);
            var filtered = keys.filter(a => a.startsWith(letter));
            div.innerText = `${letter} = ${filtered.join(', ')} — ${alphabet.filter(lt => filtered.indexOf(letter + lt) === -1).join('')}`;
            document.body.appendChild(div);
        }

        for (var i = 0; i < keys.length; i++) {
            var div = document.createElement('div');
            div.innerText = `${keys[i]} = ${data.filter(d => d.Symbol === keys[i])[0].Name}`;
            document.body.appendChild(div);
        }
        */
    };
</script>
</body>
</html>