<html>
<head>
    <style>
        body {
            background: #f8f8ff;
            font-family: 'Georgia';
        }
        h1 {
            font-size: 48pt;
            margin-bottom: 16pt;
            border-bottom: 1px solid black;
            font-family: 'Work Sans', 'Trebuchet', 'Trebuchet MS', sans-serif;
            font-weight: normal;
        }
        .module {
            border: 2px solid #666;
            width: 80px;
            height: 58px;
            float: left;
            text-align: center;
            position: relative;
            margin-right: -2px;
            margin-bottom: -2px;
        }
        .symbol {
            position: absolute;
            box-sizing: border-box;
            left: 0;
            right: 0;
            top: 0;
            height: 36px;
            padding: 7px 3px 0 36px;
            font-size: 18pt;
            text-align: center;
            background-size: 32px 32px;
            background-position: 2px 2px;
            background-repeat: no-repeat;
        }
        .souvenir {
            position: absolute;
            left: 35px;
            top: -1px;
            font-size: 8pt;
            text-align: left;
            font-family: 'Cambria';
        }
        .tpscore {
            position: absolute;
            right: 2px;
            top: -1px;
            font-size: 8pt;
            text-align: right;
            font-family: 'Cambria';
        }
        .name {
            position: absolute;
            left: 0;
            right: 0;
            top: 35px;
            bottom: 2px;
            font-size: 6pt;
        }
            .name .inner {
                position: absolute;
                left: 50%;
                top: 50%;
                width: 100%;
                transform: translate(-50%, -50%);
            }
    </style>
</head>
<body>
<h1>The Periodic Table of Modules</h1>
<div id='bomb'>
</div>
<script>
    var xhr = new XMLHttpRequest();
    xhr.open('GET', '../json/raw');
    xhr.send(null);

    xhr.onreadystatechange = function () {
        if (xhr.readyState !== 4)
            return;
        if (xhr.status !== 200) {
            console.log(xhr);
            return;
        }
        var data = JSON.parse(xhr.responseText).KtaneModules.filter(m => m.Type === 'Regular' || m.Type === 'Needy');
        var symbolsRaw = "Anagrams=Aa;Adjacent Letters=Ad;Algebra=Ae;Adventure Game=Ag;Alphabet=Al;Morse-A-Maze=Am;Alphabet Numbers=An;Answering Questions=Aq;Astrology=As;The Button=B;Blind Alley=Ba;Broken Buttons=Bb;Big Circle=Bc;Burglar Alarm=Bg;Black Hole=Bh;Bitmaps=Bi;Backgrounds=Bk;Binary LEDs=Bl;Button Masher=Bm;Square Button=Sq;Bitwise Operations=Bw;Battleship=Bp;Button Sequences=Bq;Braille=Br;British Slang=Bs;Binary Tree=Bt;The Bulb=Bu;Boolean Venn Diagram=Bv;Blind Maze=Bz;The Code=Cd;Calendar=Ca;Complicated Buttons=Cb;Connection Check=Cc;Symbolic Coordinates=Ci;Symbol Cycle=Cy;Color Flash=Cf;Chess=Ch;Coordinates=Co;The Clock=Ck;Curriculum=Cu;Color Math=Cm;Cooking=Cg;Complex Keypad=Ce;Caesar Cipher=Cp;Colored Squares=Cq;Creation=Cn;Character Shift=Cs;Cheap Checkout=Ct;The Cube=C;Colored Switches=Cw;Color Morse=Cx;Cryptography=Cr;Crazy Talk=Cz;Determinants=Ds;Double Color=Dc;Dragon Energy=De;Color Decoding=Dg;Digital Root=Di;Double-Oh=Do;Dr. Doctor=Dr;Error Codes=Ec;Emoji Math=Em;Edgework=Ek;English Test=En;Equations=Eq;S.E.T.=Et;European Travel=Ev;Extended Password=Ex;Faulty Backgrounds=Fb;Forget Everything=Fe;Flags=Fg;Filibuster=Fi;Flashing Lights=Fl;Fast Math=Fm;Forget Me Not=Fn;Foreign Exchange Rates=Fo;Friendship=Fr;Font Select=Fs;Follow the Leader=Ft;Festive Piano Keys=Fv;FizzBuzz=Fz;The Gamepad=Gp;Logic Gates=Ga;Game of Life Cruel=Gc;Color Generator=Ge;Greek Calculus=Gk;Game of Life Simple=Gl;Grid Matching=Gm;Graffiti Numbers=Gn;Gridlock=Gr;Guitar Chords=Gu;Hexamaze=Hz;Hex To Decimal=Hd;Sonic the Hedgehog=He;Human Resources=Hr;HTTP Response=Ht;Hunting=Hu;Identity Parade=Id;Ice Cream=Ic;The iPhone=Ip;The Jukebox=Ju;The Jewel Vault=Jv;Knob=Kn;Mortal Kombat=Ko;Keypad=Kp;Know Your Way=Kw;Logic=Lc;Lasers=La;Logical Buttons=Lb;Combination Lock=Cl;Laundry=Ln;LEGO=Lg;LED Grid=Ld;Light Cycle=Lh;Listening=Li;Letter Keys=Lk;Lights Out=Lo;Lightspeed=Ls;Splitting The Loot=Lt;The London Underground=Lu;LED Encryption=Le;Memory=Me;Mastermind Simple=Mm;Maze Scrambler=Mb;Morse Code=Mo;Modern Cipher=Md;Maintenance=Ma;Mafia=Mf;Maritime Flags=Mg;Mashematics=Mh;Microcontroller=Mi;Mineseeker=Mk;Mastermind Cruel=Mc;Mouse In The Maze=Mz;Monsplode Trading Cards=Mt;The Moon=Mn;Monsplode, Fight!=Mp;Mystic Square=Mq;Shape Memory=My;Motion Sense=Ms;The Stock Market=Mr;Murder=Mu;Minesweeper=Mw;Morsematics=Mx;Modules Against Humanity=Ml;Maze=M;Neutralization=Ne;The Number Cipher=Nb;Capacitor Discharge=Nc;Math=Nm;Nonogram=No;Number Pad=Np;The Number=Nu;Orientation Cube=Or;Only Connect=Oc;Password=Pw;Painting=Pa;Cruel Piano Keys=Pc;Point of Order=Pf;Playfair Cipher=Pl;Pie=Pi;Piano Keys=Pk;Plumbing=Pb;Polyhedral Maze=Pm;Pattern Cube=Pn;Poker=Po;Perspective Pegs=Pp;Probing=Pr;Symbolic Password=Ps;Perplexing Wires=Pe;Press X=Px;Poetry=Py;QR Code=Qr;Chord Qualities=Qu;Round Keypad=Rk;Radiator=Ra;Rapid Buttons=Rb;Resistors=Re;Rhythms=Rh;Random Number Generator=Rn;Rock-Paper-Scissors-Lizard-Spock=Ro;Rotary Phone=Rp;Rubik’s Cube=Rc;Refill that Beer!=Rf;Rubik’s Clock=Ru;The Swan=S;Sea Shells=Sa;Subways=Sb;Simon Screams=Sc;Skewed Slots=Sd;Semaphore=Se;Safety Safe=Sf;Simon Sings=Sg;Simon Shrieks=Sh;The Switch=Si;Skyrim=Sk;Silly Slots=Sl;Simon Samples=Sm;Sink=Sn;Simon Says=Ss;Shape Shift=Sp;The Screw=Sr;Simon States=St;Simon’s Star=So;The Sun=Su;Souvenir=Sv;Switches=Sw;Simon Sends=Sx;Synonyms=Sy;Synchronization=Sz;Two Bits=Tw;Tangrams=Ta;Third Base=Tb;Tap Code=Tc;Tetris=Te;Text Field=Tf;Tic-Tac-Toe=Ti;The Time Keeper=Tk;3D Maze=Tm;Turtle Robot=Tr;Turn The Keys=Ts;3D Tunnels=Tt;Marble Tumble=Tu;Tax Returns=Tx;Turn The Key=Ty;Timezones=Tz;Superlogic=Ul;Uncolored Squares=Uq;USA Maze=Us;Venting Gas=Vg;Visual Impairment=Vi;Complicated Wires=Vw;Wires=W;Waste Management=Wa;Web Design=Wd;Who’s on First=Wh;The Wire=Wi;Who’s That Monsplode=Wm;Word Search=Wo;Wire Placement=Wp;Wire Sequence=Wq;Word Scramble=Ws;The Stopwatch=Wt;Morse War=Wx;X01=X;X-Ray=Xr;Yahtzee=Y;Zoo=Z".split(';').map(str => str.split('='));

        var symbols = {};
        for (var i = 0; i < symbolsRaw.length; i++)
            symbols [ symbolsRaw[i][0] ] = symbolsRaw[i][1];
        for (var i = 0; i < data.length; i++)
            data[i].Symbol = symbols[data[i].Name];

        data.sort(function(a, b) {
            return a.Published < b.Published ? -1 : a.Published > b.Published ? 1 : 0;
        });

        var difficulties = {
            VeryEasy: '#dfd',
            Easy    : '#efd',
            Medium  : '#ffd',
            Hard    : '#fed',
            VeryHard: '#fdd'
        };
        var souvenirStatuses = {
            NotACandidate: 'N',
            Considered   : 'C',
            Planned      : 'P',
            Supported    : 'S'
        };
        var bomb = document.getElementById('bomb');
        function makeModule(md) {
            var div = document.createElement('div');
            div.className = 'module';
            div.style.backgroundColor = difficulties[md.ExpertDifficulty];

            var symbolDiv = document.createElement('div');
            symbolDiv.className = 'symbol';
            symbolDiv.innerText = md.Symbol || '??';
            symbolDiv.style.backgroundImage = `url('../Icons/${md.Name}.png')`;
            symbolDiv.style.backgroundColor = difficulties[md.DefuserDifficulty];

            var souvenirDiv = document.createElement('div');
            souvenirDiv.className = 'souvenir';
            souvenirDiv.innerText = souvenirStatuses [ (md.Souvenir && md.Souvenir.Status) || 'NotACandidate' ];
            var tpscoreDiv = document.createElement('div');
            tpscoreDiv.className = 'tpscore';
            tpscoreDiv.innerText = md.TwitchPlaysScore || '';

            var nameDiv = document.createElement('div');
            nameDiv.className = 'name';

            var nameInnerDiv = document.createElement('div');
            nameInnerDiv.className = 'inner';
            nameInnerDiv.innerText = md.DisplayName || md.Name;

            nameDiv.appendChild(nameInnerDiv);
            div.appendChild(symbolDiv);
            div.appendChild(nameDiv);
            div.appendChild(tpscoreDiv);
            div.appendChild(souvenirDiv);
            return div;
        }

        for (var i = 0; i < data.length; i++)
            bomb.appendChild(makeModule(data[i]));

		// Big assignments table
        if (true) {
            var keys = data.filter(d => d.Symbol).map(d => d.Symbol);
            keys.sort();
            var alphabet = ",a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z".split(',');

			var clearDiv = document.createElement('div');
			clearDiv.style.clear = 'both';

            var table = document.createElement('table');
            table.style.marginTop = '50px';

            // Header row
            var tr = document.createElement('tr');
            tr.appendChild(document.createElement('td'));
            for (var col = 0; col < alphabet.length; col++) {
                var th = document.createElement('th');
                th.innerText = alphabet[col].length ? alphabet[col] : '∅';
                tr.appendChild(th);
            }
            table.appendChild(tr);

            for (var row = 0; row < 26; row++) {
                var letter = String.fromCharCode(65 + row);
                tr = document.createElement('tr');
                function makeTh() {
                    var th = document.createElement('td');
                    th.style.width = '32px';
                    th.style.textAlign = 'center';
                    th.innerText = letter;
                    th.title = keys.filter(k => k.startsWith(letter)).map(k => `${k} = ${data.filter(d => d.Symbol === k)[0].Name}`).join("\n");
                    return th;
                }
                tr.appendChild(makeTh());
                for (var col = 0; col < alphabet.length; col++) {
                    var td = document.createElement('td');
                    var module = data.filter(d => d.Symbol === letter + alphabet[col]);
                    td.title = module.length > 0 ? module[0].Name : '';
                    td.style.backgroundColor = module.length > 1 ? '#f99' : module.length === 1 ? '' : '#bfb';
                    if (module.length === 1)
                        td.style.backgroundImage = `url('../Icons/${module[0].Name}.png')`;
                    td.style.width = '32px';
                    td.style.height = '32px';
                    td.style.padding = '0';
                    tr.appendChild(td);
                }
                tr.appendChild(makeTh());

                var td2 = document.createElement('td');
                var filtered = keys.filter(a => a.startsWith(letter));
                td2.innerText = `${alphabet.filter(lt => filtered.indexOf(letter + lt) === -1).map(lt => lt === '' ? '∅' : lt).join('')}`;
                td2.style.paddingLeft = '10px';
                tr.appendChild(td2);

                table.appendChild(tr);
            }
			document.body.appendChild(clearDiv);
            document.body.appendChild(table);
        }

		// Discrepancies
		if (false) {
			var list = [];
			for (var i = 0; i < data.length; i++) {
				var shName = data[i].Name.replace(/^The /, '').toLowerCase();
				var smb = data[i].Symbol.toLowerCase();
				if (smb.substr(0, 1) !== shName.substr(0, 1) || shName.indexOf(smb.substr(1, 1)) === -1)
					list.push(`${data[i].Symbol} = ${data[i].Name}`);
			}
			list.sort();
			for (var i = 0; i < list.length; i++) {
				var div = document.createElement('div');
				div.innerText = list[i];
				document.body.appendChild(div);
			}
			list.sort();
		}
    };
</script>
</body>
</html>